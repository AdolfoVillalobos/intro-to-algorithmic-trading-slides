<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Melb Python Meetup - Intro to Algorithmic Trading in Python</title>

		<meta name="description" content="Intro to Algorithmic Trading in Python">
		<meta name="author" content="Adolfo Villalobos">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="../dist/reset.css">
		<link rel="stylesheet" href="../dist/reveal.css">
		<link rel="stylesheet" href="../dist/theme/night.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<!-- <a href="https://revealjs.com">
						<img src="https://static.slid.es/reveal/logo-v1/reveal-white-text.svg" alt="reveal.js logo" style="height: 180px; margin: 0 auto 4rem auto; background: transparent;" class="demo-logo">
					</a> -->
					<h3>Intro to Algorithmic Trading in Python</h3>
					<p>
						<small>by <a href="http://adolfovillalobos.com">Adolfo Villalobos</a> (<a href="htttp://www.orionx.com">@orionx.com</a>)</small>
					</p>
				</section>

				<section id="fragments">
					<h2>About me!</h2>
					<p>I'm a Quantitative Developer/Software Engineer at <a href="https://www.orionx.com">OrionX</a>.</p>
					<p class="fragment">Lead developer: Trading Systems, Data Platforms & Quantitative Research.</p>
					<p class="fragment">I'm also a Python and Machine Learning enthusiast.</p>
					<p class="fragment">I have a <a>B.Sc. in Applied Maths</a> and a <a>M.Sc. in Engineering (Data Science)</a>.</p>
					<p class="fragment">6+ years of experience in quant/technology roles.</p>

					<aside class="notes">
						This slide has fragments which are also stepped through in the notes window.
					</aside>
				</section>

				<section id="fragments">
					<h2>This talk is <a>NOT</a> about!</h2>
					<p>Machine Learning/AI</p>
					<p class="fragment">Finance Theory</p>
					<p class="fragment">Blockchains</p>
					<p class="fragment">Financial Advice. Be careful!</p>

				</section>

				<section>
					<h2>Agenda</h2>
					<ul>
						<li>Strategy</li>
						<li>Design</li>
						<li>Demo</li>
						<li>Miscellaneous</li>
					</ul>
				</section>

				<section>
					<h3>Strategy</h3>
					<p class="fragment">A dropshipping analogy</p>
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/1.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/2.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/3.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/4.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/5.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section>
					<img src="https://adolfovillalobos.imgix.net/dropshipping/6.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section id="fragments">
					<h2>Then you</h2>
					<p>Wait...</p>
					<p class="fragment">Run ads</p>
					<p class="fragment">Look for other products</p>
					<p class="fragment">And then...</p>
				</section>
				<section data-background="http://i.giphy.com/90F8aUepslB84.gif">
					<h2>... you SELL!</h2>
				</section>

				<section><
					<img src="https://adolfovillalobos.imgix.net/dropshipping/8.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section style="display: flex; justify-content: center; align-items: center;">
					<img src="https://adolfovillalobos.imgix.net/dropshipping/9.png" alt="Dropshipping" style="width: 100%; height: 100vh; object-fit: contain; background: transparent;" class="demo-logo">
				</section>

				<section data-background="http://i.giphy.com/90F8aUepslB84.gif">
					<h2>... $100 profit!</h2>
				</section>


				<section>
					<h3>Strategy</h3>
					<p class="fragment">Applied to crypto</p>
					<p class="fragment"><a href="https://hummingbot.org/strategies/cross-exchange-market-making/">Liquidity mirroring</a></p>
				</section>

				<section>
					<div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem;">
						<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
							<div style="height: 200px; display: flex; align-items: center;">
								<img src="https://logos-world.net/wp-content/uploads/2021/02/Kraken-Logo.png" alt="Kraken" style="width: 100%; max-height: 100%; object-fit: contain;">
							</div>
							<ul class="fragment" style="margin-top: 2rem;">
								<li class="fragment"><a href="https://kraken.com">kraken.com</a></li>
								<li class="fragment">Our Alibaba (vendor)</li>
								<li class="fragment"><a>BTC</a>: $60.000 USD</li>
							</ul>
						</div>
						<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
							<div style="height: 200px; display: flex; align-items: center;">
								<img src="https://adolfovillalobos.imgix.net/blog/Bitfinex Dark.png" alt="Kraken" style="width: 100%; max-height: 100%; object-fit: contain;">
							</div>
							<ul class="fragment" style="margin-top: 2rem;">
								<li class="fragment"><a href="https://bitfinex.com">bitfinex.com</a></li>
								<li class="fragment">Our Shopify (store)</li>
								<li class="fragment"><a>BTC</a>: $70.000 USD</li>
								<li class="fragment" style="color: green;">Expected profit: $1000 USD</li>
							</ul>
						</div>
					</div>
				</section>

				<section id="algorithm">
					<h2>Pseudo-code</h2>
					<pre class="fragment"><code data-line-numbers="1-12|15-18|19-25" class="hljs" data-trim>while true:
    // Sample prices from Kraken
    btc_price_kraken = get_btc_price("kraken.com")
    
    // Calculate target price with profit margin
    target_price = btc_price_kraken + profit_margin
    
    // Place limit orders on Bitfinex
    if current_orders.empty():
        place_limit_order("bitfinex.com", 
            price=target_price,
            side="sell")
            
    // Compete in orderbook
    competitor_orders = get_orderbook("bitfinex.com")
    if better_price_exists(competitor_orders, target_price):
        update_order_price(target_price - small_adjustment)
        
    // Check if order filled
    if order_filled:
        execute_arbitrage() // Trade against kraken.com
        break</code></pre>
				</section>

				<section data-background="http://i.giphy.com/90F8aUepslB84.gif">
					<h2>... you SELL!</h2>
				</section>

				<section>
					<h3>Design</h3>
					<p class="fragment">Event Driven Architecture</p>
					<p class="fragment">Flow 1: Price Events</p>
					<p class="fragment">Flow 2: Trade Events</p>
				</section>

				<section>
					<h3>Flow 1: Price Events</h3>
				</section>

				<section data-background="https://adolfovillalobos.imgix.net/blog/Liquidity Mirroring Strategy BTC USDT (1).png">
				</section>

				<section>
					<h3>Flow 2: Trade Events</h3>
				</section>

				<section data-background="https://adolfovillalobos.imgix.net/blog/Flow2 Liquidity Mirroring Strategy BTC USDT.png"></section>
				</section>


				<section>
					<h3>Design</h3>
					<p class="fragment">Repo</p>
				</section>

				<section>
					<div style="display: flex; justify-content: space-between; align-items: center;">
						<div style="flex: 1;">
							<img src="https://adolfovillalobos.imgix.net/blog/algo-trading-repo-structure.png" alt="Flow 1" style="width: 100%; object-fit: contain; background: transparent;" class="demo-logo">
						</div>
						<div style="flex: 1; padding-left: 1rem; max-width: 80%; font-size: 0.7em;">
							<ul style="margin: 0; padding: 0 0 0 1.5em;">
								<li class="fragment">Microservices (mono-repo)</li>
								<li class="fragment"><a>price-watch</a>: price events</li>
								<li class="fragment"><a>trade-watch</a>: trade events</li>
								<li class="fragment"><a>place-orders</a>: execute limit/market orders</li>
								<li class="fragment"><a>bot-operator</a>: implement strategy</li>
								<li class="fragment"><a>.github/workflows</a>: CI/CD, testing, etc.</li>
								<li class="fragment"><a>docker-compose.dev.yml</a>: containerize</li>
								<li class="fragment"><a>Makefile</a>: useful commands</li>
							</ul>
						</div>
					</div>
				</section>

				<section>
					<h3>Code</h3>
					<p class="fragment">Price Watch</p>
				</section>

				<section>
					<h2>Price Watch</h2>
					<p>Price source - Strategy design pattern</p>

					<pre><code data-line-numbers="1-2|4-6|8-14|19-25|26-28|29-32" class="hljs" data-trim style="font-size: 0.7em;">
					class PriceSource(BaseModel, ABC):
						"""Abstract base class for different price data sources"""
					
						@abstractmethod
						async def watch_prices(self, symbol: str) -> AsyncIterator[PriceMessage]:
							pass

					import ccxt.pro as ccxt

					class CCXTPriceSource(PriceSource):
						"""Generate prices from a CCXT client"""
					
						exchange: ccxt.Exchange
						exchange_name: str
					
						class Config:
							arbitrary_types_allowed = True
					
						async def watch_prices(self, symbol: str) -> AsyncIterator[PriceMessage]:
							last_message = None
							while True:
								try:
									// Get the orderbook from the exchange
									orderbook = await self.exchange.watch_order_book(symbol)

									// Convert into a PriceMessage
									new_message = PriceMessage.from_orderbook(orderbook, self.exchange_name)
					
									// Yield the new price if it has changeds
									if last_message is None or last_message.has_changed(new_message):
										last_message = new_message
										yield new_message
								except Exception as e:
									logger.error(f"Error watching {symbol}: {e}")
								finally:
									await asyncio.sleep(2)
	</code></pre>
				</section>

				<section>
					<h2>Price Watch</h2>
					<p>RabbitMQ Message queue - Pub/Sub pattern</p>
					<pre><code data-line-numbers="1-5|10-12|14-22|25-28|30-32" class="hljs" data-trim style="font-size: 0.7em;">
						import aio_pika

						class MessageQueuePublisher(BaseModel):
							channel: Optional[aio_pika.Channel] = None
							connection: Optional[aio_pika.Connection] = None
					
							class Config:
								arbitrary_types_allowed = True
						
							async def connect(self, rabbitmq_url: str):
								self.connection = await aio_pika.connect_robust(rabbitmq_url)
								self.channel = await self.connection.channel()
						
							async def publish(self, message: PriceMessage):

								if self.channel is None:
									self.channel = await self.connection.channel()

								logger.info("Publishing price message to %s: %s", message.subject(), message)

								// Convert out price into a RabbitMQ message
								amqp_message = aio_pika.Message(body=message.model_dump_json().encode())

								// Publish the message to the Price subject
								await self.channel.default_exchange.publish(
									amqp_message,
									routing_key=message.subject(), // i.e price_updates_kraken
								)
					
							async def close(self):
								if self.connection:
									await self.connection.close()
				</code></pre>
				</section>

				<section>
					<h2>Price Watch</h2>
					<p>Main loop</p>
					<pre><code data-line-numbers="1-7|9-10|12-14|16-18" class="hljs" data-trim style="font-size: 0.9em;">

						async def price_service(
							price_source: PriceSource,
							publisher: MessageQueuePublisher,
							symbol: str,
							rabbitmq_url: str,
						) -> None:

							try:
								// Connect to RabbitMQ
								await publisher.connect(rabbitmq_url)

								// Watch prices from the price source
								async for price_message in price_source.watch_prices(symbol):
									await publisher.publish(price_message)

							finally:
								// Close the connection
								await publisher.close()

					</code></pre>
				</section>


				<section>
					<h3>Code</h3>
					<p class="fragment">Bot operator</p>
				</section>

				<section>
					<h2>Thanks! The END</h2>
					<div style="display: flex; justify-content: center; gap: 8rem;">
						<div style="text-align: center;">
							<img src="https://adolfovillalobos.imgix.net/blog/QR%20Linkedin.png" alt="LinkedIn QR code" style="height: 180px; background: transparent;" class="demo-logo">
							<p><small>LinkedIn</small></p>
						</div>
						<div style="text-align: center;">
							<img src="https://adolfovillalobos.imgix.net/blog/QR%20GitHub%20500x500.png" alt="GitHub QR code" style="height: 180px; background: transparent;" class="demo-logo">
							<p><small>GitHub</small></p>
						</div>
					</div>
				</section>


			</div>

		</div>

		<script src="../dist/reveal.js"></script>
		<script src="../plugin/zoom/zoom.js"></script>
		<script src="../plugin/notes/notes.js"></script>
		<script src="../plugin/search/search.js"></script>
		<script src="../plugin/markdown/markdown.js"></script>
		<script src="../plugin/highlight/highlight.js"></script>
		<script>

			// Also available as an ES module, see:
			// https://revealjs.com/initialization/
			Reveal.initialize({
				controls: true,
				progress: true,
				center: true,
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});

		</script>

	</body>
</html>
